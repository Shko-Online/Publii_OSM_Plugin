trigger: 
- main

name: 1.0.$(Date:yy)$(Rev:rrr) - Shko Online's OSM Plugin

pool:
  name: Shko Online

steps:
- task: NodeTool@0
  inputs:
      versionSpec: '22.x'
  displayName: 'Install Node.js'

- powershell: |
    $BuildNumber = ($env:BuildNumber).Substring(0,($env:BuildNumber).IndexOf(' '));
    $package = Get-Content package.json | ConvertFrom-Json;
    $package.version = $BuildNumber;
    $package | ConvertTo-Json | Set-Content package.json;
    echo "##vso[task.setvariable variable=BuildNumber;isOutput=true]$BuildNumber"
  name: MyVars
  env:
    BuildNumber: $(Build.BuildNumber)
  displayName: 'Set Version Variable'

- task: Npm@1
  inputs:
    command: 'install'
    workingDir: '$(System.DefaultWorkingDirectory)'
  displayName: 'Install NPM Dependencies Web'

- task: Npm@1
  inputs:
    command: 'custom'
    customCommand: 'run-script build'
    workingDir: '$(System.DefaultWorkingDirectory)'
  displayName: 'Build Publii Plugin'

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(System.DefaultWorkingDirectory)/dist'
    artifact: 'PubliiPlugin'
    publishLocation: 'pipeline'
